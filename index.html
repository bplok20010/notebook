<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1"
        />
        <meta name="description" content="quantitative finance in javascript" />
        <meta name="author" content="Jin Yang" />
        <meta
            name="keywords"
            content="quantlib.js, notebook, math, javascript, quant, quantitative, finance, quantitative finance, mathematical finance"
        />
        <meta
            name="google-site-verification"
            content="4IrXoRzLpuCL684J3Y19wWtY9W5KqlvwLH5EQuZh1-Q"
        />
        <title>quantlib.js notebook Â© 2020 Jin Yang</title>
        <link rel="shortcut icon" type="image/jpg" href="/made-in-china.jpg" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@forevolve/bootstrap-dark@1.0.0-alpha.978/dist/css/toggle-bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@forevolve/bootstrap-dark@1.0.0-alpha.978/dist/css/toggle-bootstrap-dark.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/lib/codemirror.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/theme/base16-light.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/theme/base16-dark.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
        />

        <!-- <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=UA-87290595-6"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());

            gtag("config", "UA-87290595-6");
        </script> -->
        <style>
            .CodeMirror {
                height: auto;
            }

            .cell.row {
                border-color: #191d21;
                border-width: 0.5px;
                border-style: solid;
                padding: 2px;
                margin: 2px;
            }

            body {
                position: relative;
            }

            body::-webkit-scrollbar {
                width: 0 !important;
            }

            #toc {
                top: 56px;
                left: 20px;
            }

            nav[data-toggle="toc"] .nav > li > a {
                display: block;
                padding: 4px 20px;
                font-size: 16px;
                font-weight: 500;
                color: #767676;
            }

            nav[data-toggle="toc"] .nav > li > a:hover,
            nav[data-toggle="toc"] .nav > li > a:focus {
                padding-left: 19px;
                color: #563d7c;
                text-decoration: none;
                background-color: transparent;
                border-left: 1px solid #563d7c;
            }

            nav[data-toggle="toc"] .nav-link.active,
            nav[data-toggle="toc"] .nav-link.active:hover,
            nav[data-toggle="toc"] .nav-link.active:focus {
                padding-left: 18px;
                font-weight: bold;
                color: #563d7c;
                background-color: transparent;
                border-left: 2px solid #563d7c;
            }

            nav[data-toggle="toc"] .nav-link + ul {
                display: none;
                /* Hide by default, but at >768px, show it */
                padding-bottom: 10px;
            }

            nav[data-toggle="toc"] .nav .nav > li > a {
                padding-top: 1px;
                padding-bottom: 1px;
                padding-left: 30px;
                font-size: 14px;
                font-weight: normal;
            }

            nav[data-toggle="toc"] .nav .nav > li > a:hover,
            nav[data-toggle="toc"] .nav .nav > li > a:focus {
                padding-left: 29px;
            }

            nav[data-toggle="toc"] .nav .nav > li > .active,
            nav[data-toggle="toc"] .nav .nav > li > .active:hover,
            nav[data-toggle="toc"] .nav .nav > li > .active:focus {
                padding-left: 28px;
                font-weight: 500;
            }

            nav[data-toggle="toc"] .nav-link.active + ul {
                display: block;
            }

            blockquote {
                border-left: 4px solid #ddd;
                padding: 0 15px;
                color: #777;
            }
        </style>
    </head>

    <body
        class="bootstrap-dark"
        data-spy="scroll"
        data-target="#toc"
        data-offset="56"
    >
        <nav
            id="toolbar"
            class="navbar sticky-top navbar-expand-lg navbar-themed"
        >
            <div class="container-fluid">
                <a class="navbar-brand" href="/notebook">quantlib.js</a>
                <button
                    class="navbar-toggler"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div
                    class="collapse navbar-collapse"
                    id="navbarSupportedContent"
                >
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" onclick="add('javascript');"
                                ><i class="fa fa-plus"></i
                            ></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="runUp();"
                                ><i class="fa fa-angle-double-up"></i
                            ></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="runDown();"
                                ><i class="fa fa-angle-double-down"></i
                            ></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="runAll();"
                                ><i class="fa fa-forward"></i
                            ></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" onclick="clearAll();"
                                ><i class="fa fa-close"></i
                            ></a>
                        </li>
                        <li class="nav-item">
                            <a
                                class="nav-link"
                                target="_blank"
                                href="/notebook/#tutorial.en.json"
                                >Tutorial <i class="fa fa-external-link"></i
                            ></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" target="_blank" href="/docs"
                                >API Docs <i class="fa fa-external-link"></i
                            ></a>
                        </li>
                        <li class="nav-item">
                            <a
                                class="nav-link"
                                target="_blank"
                                href="/test-suite"
                                >Test Suite <i class="fa fa-external-link"></i
                            ></a>
                        </li>
                    </ul>
                    <form class="form-inline">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link"
                                    ><i class="fa fa-copyright"></i> Jin Yang</a
                                >
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="color();"
                                    ><i class="fa fa-adjust"></i
                                ></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="toggleEngine();"
                                    ><i id="engine" class="fa fa-toggle-on"></i
                                ></a>
                            </li>
                            <li class="nav-item">
                                <a
                                    class="nav-link"
                                    onclick="$('#file-input').click();"
                                    ><i class="fa fa-upload"></i
                                ></a>
                            </li>
                            <li class="nav-item">
                                <a
                                    class="nav-link"
                                    onclick="saveAs($('#filename').val(),toJSON());"
                                    ><i class="fa fa-download"></i
                                ></a>
                            </li>
                        </ul>
                        <input
                            class="form-control"
                            id="filename"
                            type="search"
                            placeholder="notebook.json"
                        />
                    </form>
                </div>
            </div>
        </nav>
        <div class="container-fluid">
            <div class="row" id="root">
                <div id="tocroot" class="col-xl-2 hidden-lg-down">
                    <nav id="toc" class="sticky-top" data-toggle="toc"></nav>
                </div>
                <div id="nbroot" class="col-lg-12 col-xl-10">
                    <div id="notebook" class="container-fluid"></div>
                </div>
            </div>
        </div>
        <input type="file" id="file-input" style="display: none;" />
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@forevolve/bootstrap-dark@1.0.0-alpha.978/dist/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/lib/codemirror.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/mode/javascript/javascript.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/mode/markdown/markdown.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/eval5@1.4.4/umd/eval5.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked@0.8.2/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/mathjs@6.6.2/dist/math.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@1.53.0/plotly.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/typescript@3.5.3/lib/typescript.js"></script>
        <script>
            var interpreter,
                file,
                counter = 0,
                cells = {},
                theme = "dark",
                color_enter = "#C1E0FF",
                light_leave = "#ffffff",
                dark_leave = "#191d21",
                selected = NaN,
                running = NaN,
                offset = 55,
                engine = "eval5",
                reader = new FileReader();
            function color() {
                "dark" === theme
                    ? ((theme = "light"),
                      $(".row").css("border-color", light_leave))
                    : ((theme = "dark"),
                      $(".row").css("border-color", dark_leave)),
                    $("body").removeClass();
                var e = "dark" === theme ? "bootstrap-dark" : "bootstrap";
                for (id in ($("body").addClass(e), cells))
                    cells[id].setOption("theme", `base16-${theme}`);
                $(`#cell${selected}`).find(".btn-group").show(),
                    $(`#cell${selected}`).css({ "border-color": color_enter });
            }
            function setTheme(e) {
                "light" === (theme = e)
                    ? $(".row").css("border-color", light_leave)
                    : $(".row").css("border-color", dark_leave),
                    $("body").removeClass();
                var t = "dark" === theme ? "bootstrap-dark" : "bootstrap";
                for (id in ($("body").addClass(t), cells))
                    cells[id].setOption("theme", `base16-${theme}`);
                $(`#cell${selected}`).find(".btn-group").show(),
                    $(`#cell${selected}`).css({ "border-color": color_enter });
            }
            function getEditor(e, t) {
                var n = document.getElementById(e);
                return CodeMirror.fromTextArea(n, {
                    theme: `base16-${theme}`,
                    lineWrapping: !0,
                    mode: t,
                });
            }
            function toggle(e) {
                "javascript" === cells[e].options.mode
                    ? cells[e].setOption("mode", "markdown")
                    : cells[e].setOption("mode", "javascript"),
                    $(`#cell${e} .fa-code`).length > 0
                        ? ($(`#cell${e} .fa-code`).addClass("fa-sticky-note-o"),
                          $(`#cell${e} .fa-code`).removeClass("fa-code"))
                        : ($(`#cell${e} .fa-sticky-note-o`).addClass("fa-code"),
                          $(`#cell${e} .fa-sticky-note-o`).removeClass(
                              "fa-sticky-note-o"
                          ));
            }
            function eye(e) {
                $(`#in${e}`).is(":visible")
                    ? ($(`#in${e}`).hide(),
                      $(`#cell${e} .fa-bars`).addClass("fa-ellipsis-v"),
                      $(`#cell${e} .fa-bars`).removeClass("fa-bars"))
                    : ($(`#in${e}`).show(),
                      $(`#cell${e} .fa-ellipsis-v`).addClass("fa-bars"),
                      $(`#cell${e} .fa-ellipsis-v`).removeClass(
                          "fa-ellipsis-v"
                      ),
                      setTimeout(function () {
                          cells[e].refresh();
                      }, 10));
            }
            function add(e, t = NaN) {
                var n = counter++,
                    o =
                        '<div id="cell' +
                        n +
                        '" class="cell row" onclick="select(' +
                        n +
                        ');">\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="btn-group pull-right" role="group">\n<button type="button" class="btn btn-sm" onclick="toggle(' +
                        n +
                        ')"><i class="' +
                        ("javascript" === e
                            ? "fa fa-code"
                            : "fa fa-sticky-note-o") +
                        '"></i></button>\n<button type="button" class="btn btn-sm" onclick="eye(' +
                        n +
                        ');"><i class="fa fa-bars"></i></button>\n<button type="button" class="btn btn-sm" onclick="run(' +
                        n +
                        ');"><i class="fa fa-play"></i></button>\n</div>\n</div>\n<div class="col-lg-12 col-xl-10 px-0">\n<div id="in' +
                        n +
                        '"><textarea id="edit' +
                        n +
                        '"></textarea></div>\n<div id="out' +
                        n +
                        '"></div>\n</div>\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="btn-group" role="group">\n<button type="button" class="btn btn-sm" onclick="$(\'#cell' +
                        n +
                        "').insertBefore($('#cell" +
                        n +
                        '\').prev(\'.row\'));"><i class="fa fa-angle-up"></i></button>\n<button type="button" class="btn btn-sm" onclick="del(' +
                        n +
                        ');"><i class="fa fa-trash-o"></i></button>\n<button type="button" class="btn btn-sm" onclick="$(\'#cell' +
                        n +
                        "').insertAfter($('#cell" +
                        n +
                        "').next('.row'));\"><i class=\"fa fa-angle-down\"></i></button>\n</div>\n</div>\n</div>";
                isNaN(selected)
                    ? $("#notebook").append(o)
                    : $(o).insertAfter(`#cell${selected}`);
                var l = getEditor(`edit${n}`, e);
                (cells[n] = l),
                    $(`#cell${n} .btn-group`).hide(),
                    $(`#cell${n}`).css({
                        "border-color":
                            "dark" === theme ? dark_leave : light_leave,
                    });
            }
            function del(e) {
                $(`#cell${e}`).remove(), delete cells[e];
            }
            function toJSON() {
                for (
                    var e = {}, t = $("#notebook .row"), n = 0;
                    n < t.length;
                    n++
                ) {
                    var o = t[n].id.substr(4),
                        l = {};
                    (l.input = {
                        type: cells[o].options.mode,
                        source: cells[o].getValue(),
                    }),
                        (l.show_editor = $(`#in${o}`).is(":visible")),
                        (l.output = {
                            type: "html",
                            content: $(`#out${o}`).html(),
                        }),
                        (e[`${t[n].id}`] = l);
                }
                return JSON.stringify(e, null, "\t");
            }
            function saveAs(e, t) {
                "" == e && (e = "notebook.json");
                var n = document.createElement("a");
                n.setAttribute(
                    "href",
                    "data:text/plain;charset=utf-8," + encodeURIComponent(t)
                ),
                    n.setAttribute("download", e),
                    (n.style.display = "none"),
                    document.body.appendChild(n),
                    n.click(),
                    document.body.removeChild(n);
            }
            function fromJSON(e) {
                for (cell in ((cells = []),
                (counter = 0),
                (selected = NaN),
                $("#notebook").empty(),
                e)) {
                    var t = parseInt(cell.substr(4), 10);
                    counter < t && (counter = t);
                    var n = e[cell].input.type,
                        o =
                            '<div id="cell' +
                            t +
                            '" class="cell row" onclick="select(' +
                            t +
                            ');">\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="btn-group pull-right" role="group">\n<button type="button" class="btn btn-sm" onclick="toggle(' +
                            t +
                            ')"><i class="' +
                            ("javascript" === n
                                ? "fa fa-code"
                                : "fa fa-sticky-note-o") +
                            '"></i></button>\n<button type="button" class="btn btn-sm" onclick="eye(' +
                            t +
                            ');"><i class="fa fa-bars"></i></button>\n<button type="button" class="btn btn-sm" onclick="run(' +
                            t +
                            ');"><i class="fa fa-play"></i></button>\n</div>\n</div>\n<div class="col-lg-12 col-xl-10 px-0">\n<div id="in' +
                            t +
                            '"><textarea id="edit' +
                            t +
                            '"></textarea></div>\n<div id="out' +
                            t +
                            '">' +
                            e[cell].output.content +
                            '</div>\n</div>\n<div class="col-xl-1 hidden-lg-down px-0">\n<div class="btn-group" role="group">\n<button type="button" class="btn btn-sm" onclick="$(\'#cell' +
                            t +
                            "').insertBefore($('#cell" +
                            t +
                            '\').prev(\'.row\'));"><i class="fa fa-angle-up"></i></button>\n<button type="button" class="btn btn-sm" onclick="del(' +
                            t +
                            ');"><i class="fa fa-trash-o"></i></button>\n<button type="button" class="btn btn-sm" onclick="$(\'#cell' +
                            t +
                            "').insertAfter($('#cell" +
                            t +
                            "').next('.row'));\"><i class=\"fa fa-angle-down\"></i></button>\n</div>\n</div>\n</div>";
                    $("#notebook").append(o);
                    var l = getEditor(`edit${t}`, n);
                    l.setValue(e[cell].input.source),
                        setTimeout(function () {
                            l.refresh();
                        }, 10),
                        (cells[t] = l),
                        e[cell].show_editor || eye(t);
                }
                $(".btn-group").hide(),
                    $(".cell.row").css({
                        "border-color":
                            "dark" === theme ? dark_leave : light_leave,
                    }),
                    hover(),
                    counter++,
                    updateToc();
            }
            function select(e) {
                selected != e &&
                    ($(`#cell${selected}`).find(".btn-group").hide(),
                    $(`#cell${selected}`).css({
                        "border-color":
                            "dark" === theme ? dark_leave : light_leave,
                    }),
                    $(`#cell${selected}`).css({ "border-left-width": "0.5px" }),
                    (selected = e),
                    $(`#cell${e}`).css({ "border-left-width": "6px" }));
            }
            function hover() {
                $(document).on(
                    {
                        mouseenter: function () {
                            "xl" == getResponsiveBreakpoint() &&
                                $(this).find(".btn-group").show(),
                                $(this).css({ "border-color": color_enter });
                        },
                        mouseleave: function () {
                            $(this).attr("id").substr(4) != selected &&
                                ("xl" == getResponsiveBreakpoint() &&
                                    $(this).find(".btn-group").hide(),
                                $(this).css({
                                    "border-color":
                                        "dark" === theme
                                            ? dark_leave
                                            : light_leave,
                                }));
                        },
                    },
                    ".cell.row"
                );
            }
            function readSingleFile(e) {
                (file = e.target.files[0]) && reader.readAsText(file);
            }
            function load(e) {
                try {
                    fetch(e)
                        .then((e) => e.json())
                        .then((e) => {
                            fromJSON(e);
                        });
                } catch (e) {
                    console.log(e);
                }
            }
            function output(e, t) {
                if (void 0 !== e)
                    switch ((null == e.type && (e.type = "xxx"), e.type)) {
                        case "plot":
                            Plotly.newPlot(
                                `ot${t}`,
                                e.data,
                                e.layout,
                                e.option
                            );
                            break;
                        case "table":
                            var n = `${e.data}`;
                            $(`#ot${t}`).append(n);
                            break;
                        case "text":
                            n = `<code>${e.data}</code>`;
                            $(`#ot${t}`).append(n);
                            break;
                        default:
                            n = `<code>${e}</code>`;
                            $(`#ot${t}`).append(n);
                    }
                else if ($(`#ot${t}`).is(":empty")) {
                    n = `<code>${e}</code>`;
                    $(`#ot${t}`).append(n);
                }
            }
            function print(e) {
                var t = `<code>${e}<br></code>`;
                $(`#ot${running}`).append(t);
            }
            function varlist() {
                var e = [];
                for (p in interpreter.globalContext)
                    "ql" != p &&
                        "console" != p &&
                        "math" != p &&
                        "plot" != p &&
                        "print" != p &&
                        "table" != p &&
                        e.push({
                            name: p,
                            type: typeof interpreter.globalContext[p],
                            value: interpreter.globalContext[p],
                        });
                var t = '<table class="table table-striped">',
                    n = e[0];
                for (td in ((t += "<thead><tr>"), n)) t += `<th>${td}</th>`;
                t += "</tr></thead><tbody>";
                for (var o = 0; o < e.length; o++) {
                    for (td in ((t += "<tr>"), e[o]))
                        t += `<td>${e[o][td]}</td>`;
                    t += "</tr>";
                }
                (t += "</tbody></table>"),
                    $("#vartable").empty(),
                    $("#vartable").append(t);
            }
            function table(e) {
                if (!Array.isArray(e)) return print(e);
                var t = '<table class="table table-striped">',
                    n = e[0];
                for (td in ((t += "<thead><tr>"), n)) t += `<th>${td}</th>`;
                t += "</tr></thead><tbody>";
                for (var o = 0; o < e.length; o++) {
                    for (td in ((t += "<tr>"), e[o]))
                        t += `<td>${e[o][td]}</td>`;
                    t += "</tr>";
                }
                var l = `${(t += "</tbody></table>")}`;
                $(`#ot${running}`).append(l);
            }
            function plot(e, t = {}, n = {}) {
                return (
                    (t.plot_bgcolor =
                        "dark" == theme ? dark_leave : light_leave),
                    (t.paper_bgcolor =
                        "dark" == theme ? dark_leave : light_leave),
                    (n.displaylogo = !1),
                    (n.responsive = !0),
                    { type: "plot", data: e, layout: t, option: n }
                );
            }
            function run(e) {
                (running = e),
                    $(`#out${e}`).empty(),
                    $(`#out${e}`).append(`<div id=ot${e}></div>`);
                var t = cells[e].getValue();
                if ("javascript" === cells[e].options.mode)
                    try {
                        var n = ts.transpileModule(t, {
                            compilerOptions: { target: "es5" },
                        }).outputText;
                        output(
                            (o =
                                "eval5" == engine
                                    ? interpreter.evaluate(`${n}`)
                                    : window.eval(`with(ql){${n}}`)),
                            e
                        );
                    } catch (l) {
                        console.log(l);
                        $(`#ot${e}`).append(`<code>${l.message}</code>`);
                    }
                else {
                    $(`#in${e}`).is(":visible") &&
                        ($(`#in${e}`).hide(),
                        $(`#cell${e} .fa-bars`).addClass("fa-ellipsis-v"),
                        $(`#cell${e} .fa-bars`).removeClass("fa-bars"));
                    try {
                        var o = protectMath(t);
                        $(`#ot${e}`).append(`${o}`);
                        var l = document.getElementById(`ot${e}`);
                        renderMathInElement(l, {
                            delimiters: [
                                { left: "$$", right: "$$", display: !0 },
                                { left: "$", right: "$", display: !1 },
                            ],
                        });
                    } catch (l) {
                        $(`#out${e}`).append(`<pre>${l.message}</pre>`);
                    }
                }
                updateToc();
            }
            function runUp() {
                for (var e = $("#notebook .row"), t = 0; t < e.length; t++) {
                    var n = parseInt(e[t].id.substr(4), 10);
                    if (n == selected) break;
                    run(n);
                }
            }
            function runDown() {
                for (
                    var e = $("#notebook .row"), t = [], n = 0;
                    n < e.length;
                    n++
                ) {
                    var o = parseInt(e[n].id.substr(4), 10);
                    t.push(o);
                }
                var l = t.indexOf(selected);
                if (l > -1) for (n = l; n < t.length; n++) run(t[n]);
            }
            function runAll() {
                for (var e = $("#notebook .row"), t = 0; t < e.length; t++) {
                    run(e[t].id.substr(4));
                }
            }
            function runMD() {
                for (var e = $("#notebook .row"), t = 0; t < e.length; t++) {
                    var n = e[t].id.substr(4);
                    0 === $(`#cell${n} .fa-code`).length && run(n);
                }
            }
            function updateToc() {
                if ("xl" == getResponsiveBreakpoint()) {
                    $("#toc").empty();
                    var e = createChildNavList($("#toc")),
                        t = getTopLevel($("#notebook"));
                    populateNav(e, t, getHeadings($("#notebook"), t)),
                        $('[data-spy="scroll"]').each(function () {
                            $(this).scrollspy("refresh");
                        }),
                        $("#toc a").on("click", function (e) {
                            e.preventDefault(),
                                $("html, body").scrollTop(
                                    $($(this).attr("href")).offset().top -
                                        offset
                                );
                        });
                }
            }
            function runCode() {
                for (var e = $("#notebook .row"), t = 0; t < e.length; t++) {
                    var n = e[t].id.substr(4);
                    $(`#cell${n} .fa-code`).length > 0 && run(n);
                }
            }
            function clearAll() {
                for (var e = $("#notebook .row"), t = 0; t < e.length; t++) {
                    var n = e[t].id.substr(4);
                    $(`#out${n}`).empty(),
                        $(`#in${n}`).is(":visible") ||
                            ($(`#in${n}`).show(),
                            $(`#cell${n} .fa-ellipsis-v`).addClass("fa-bars"),
                            $(`#cell${n} .fa-ellipsis-v`).removeClass(
                                "fa-ellipsis-v"
                            ),
                            setTimeout(function () {
                                cells[n].refresh();
                            }, 10));
                }
                $("#toc").empty();
            }
            function clearCode() {
                for (var e = $("#notebook .row"), t = 0; t < e.length; t++) {
                    var n = e[t].id.substr(4);
                    $(`#cell${n} .fa-code`).length > 0 &&
                        ($(`#out${n}`).empty(),
                        $(`#in${n}`).is(":visible") ||
                            ($(`#in${n}`).show(),
                            $(`#cell${n} .fa-ellipsis-v`).addClass("fa-bars"),
                            $(`#cell${n} .fa-ellipsis-v`).removeClass(
                                "fa-ellipsis-v"
                            )));
                }
            }
            function compass() {
                NaN != selected &&
                    $("html, body").scrollTop(
                        $(`#cell${selected}`).offset().top - offset
                    );
            }
            function findOrFilter(e, t) {
                var n = e.find(t);
                return e.filter(t).add(n).filter(":not([data-toc-skip])");
            }
            function createChildNavList(e) {
                var t = $('<ul class="nav navbar-nav"></ul>');
                return e.append(t), t;
            }
            function generateNavEl(e, t) {
                var n = $('<a class="nav-link"></a>');
                n.attr("href", "#" + e), n.text(t);
                var o = $("<li></li>");
                return o.append(n), o;
            }
            function generateNavItem(e) {
                var t = e.id,
                    n = $(e);
                return generateNavEl(t, n.data("toc-text") || n.text());
            }
            function getTopLevel(e) {
                for (var t = 1; t <= 6; t++) {
                    if (findOrFilter(e, "h" + t).length > 1) return t;
                }
                return 1;
            }
            function getHeadings(e, t) {
                return findOrFilter(e, "h" + t + "," + ("h" + (t + 1)));
            }
            function getNavLevel(e) {
                return parseInt(e.tagName.charAt(1), 10);
            }
            function populateNav(e, t, n) {
                var o,
                    l = e;
                n.each(function (n, a) {
                    var r = generateNavItem(a);
                    getNavLevel(a) === t
                        ? (l = e)
                        : o && l === e && (l = createChildNavList(o)),
                        l.append(r),
                        (o = r);
                });
            }
            function getResponsiveBreakpoint() {
                var e = {
                        xs: "d-none",
                        sm: "d-sm-none",
                        md: "d-md-none",
                        lg: "d-lg-none",
                        xl: "d-xl-none",
                    },
                    t = "",
                    n = $("<div>");
                n.appendTo($("body"));
                for (
                    var o = Object.keys(e).length - 1;
                    o >= 0 &&
                    ((t = Object.keys(e)[o]),
                    n.addClass(e[t]),
                    !n.is(":hidden"));
                    o--
                );
                return n.remove(), t;
            }
            var tokenType = { MARK: 0, MASK: 1 },
                tokenLiteral = { MASK: "::MASK::" };
            function tokenize(e) {
                for (
                    var t,
                        n,
                        o = [
                            "\\\\\\$",
                            "\\$\\$(?:[^\\\\]|\\\\.)*?\\$\\$",
                            "\\$(?:[^$\\\\]|\\\\.)+?\\$",
                            tokenLiteral.MASK,
                        ].join("|"),
                        l = new RegExp(o, "g"),
                        a = [],
                        r = 0;
                    null !== (t = l.exec(e));

                )
                    t.index > r &&
                        ((n = e.substring(r, t.index)),
                        a.push([tokenType.MARK, n])),
                        a.push([tokenType.MASK, t[0]]),
                        (r = l.lastIndex);
                return (
                    (n = e.substring(r)),
                    e.length > r && a.push([tokenType.MARK, n]),
                    a
                );
            }
            function protectMath(e) {
                for (
                    var t = tokenize(e), n = "", o = [], l = 0;
                    l < t.length;
                    l++
                )
                    t[l][0] == tokenType.MARK
                        ? (n += t[l][1])
                        : (o.push(l), (n += tokenLiteral.MASK));
                n = marked(n);
                var a = new RegExp(tokenLiteral.MASK, "g"),
                    r = 0;
                return (n = n.replace(a, function () {
                    return t[o[r++]][1];
                }));
            }
            function detectBrowser() {
                var e =
                        (!!window.opr && !!opr.addons) ||
                        !!window.opera ||
                        navigator.userAgent.indexOf(" OPR/") >= 0,
                    t = "undefined" != typeof InstallTrigger,
                    n =
                        /constructor/i.test(window.HTMLElement) ||
                        "[object SafariRemoteNotification]" ===
                            (
                                !window.safari ||
                                ("undefined" != typeof safari &&
                                    safari.pushNotification)
                            ).toString(),
                    o = !!document.documentMode,
                    l = !o && !!window.StyleMedia,
                    a = !(
                        !window.chrome ||
                        (!window.chrome.webstore && !window.chrome.runtime)
                    );
                a && navigator.userAgent.indexOf("Edg");
                e
                    ? $("#browser").addClass("fa fa-opera")
                    : t
                    ? $("#browser").addClass("fa fa-firefox")
                    : n
                    ? $("#browser").addClass("fa fa-safari")
                    : o
                    ? $("#browser").addClass("fa fa-internet-explorer")
                    : l
                    ? $("#browser").addClass("fa fa-edge")
                    : a
                    ? $("#browser").addClass("fa fa-chrome")
                    : $("#browser").addClass("fa fa-question");
            }
            function toggleEngine() {
                "eval5" == engine
                    ? ((engine = "evil"),
                      $("#engine").addClass("fa-toggle-off"),
                      $("#engine").removeClass("fa-toggle-on"))
                    : ((engine = "eval5"),
                      $("#engine").addClass("fa-toggle-on"),
                      $("#engine").removeClass("fa-toggle-off"));
            }
            function main() {
                document
                    .getElementById("file-input")
                    .addEventListener("change", readSingleFile, !1),
                    document.getElementById("file-input").addEventListener(
                        "click",
                        function () {
                            this.value = null;
                        },
                        !1
                    ),
                    (reader.onload = function (e) {
                        var t = e.target.result;
                        try {
                            fromJSON(JSON.parse(t)),
                                $("#filename").val(file.name);
                        } catch (e) {
                            console.log(e);
                        } finally {
                            (file = void 0), (t = void 0);
                        }
                    }),
                    window.addEventListener("resize", function () {
                        "xl" == getResponsiveBreakpoint()
                            ? runMD()
                            : ($("#toc").empty(),
                              $(`#cell${selected}`).find(".btn-group").hide());
                    });
                var e = new marked.Renderer();
                (e.link = function (e, t, n) {
                    var o = marked.Renderer.prototype.link.apply(
                        this,
                        arguments
                    );
                    return o.replace("<a", "<a target='_blank'");
                }),
                    marked.setOptions({ renderer: e, gfm: !0 }),
                    $(document).on("dragenter", function (e) {
                        e.stopPropagation(), e.preventDefault();
                    }),
                    $(document).on("dragover", function (e) {
                        e.stopPropagation(), e.preventDefault();
                    }),
                    $(document).on("drop", function (e) {
                        e.preventDefault(),
                            (file = e.originalEvent.dataTransfer.files[0]) &&
                                reader.readAsText(file);
                    }),
                    detectBrowser(),
                    import(
                        "https://cdn.jsdelivr.net/npm/@quantlib/ql@latest/ql.mjs"
                    ).then(function (e) {
                        var ql = {};
                        Object.keys(e).forEach((key) => (ql[key] = e[key]));

                        var t = {
                            ql: e,
                            console: console,
                            math: math,
                            plot: plot,
                            print: print,
                            table: table,
                        };
                        (window.ql = e),
                            (interpreter = new eval5.Interpreter(t, {
                                rootContext: ql,
                            }));
                        var n = window.location.hash;
                        if ("" !== n) {
                            var o = (n = n.substr(1)).split("/"),
                                l = o[o.length - 1];
                            $("#filename").val(l),
                                load("https://quantlib.js.org/notebook/" + n);
                        }
                        hover();
                    });
            }
            main();
        </script>
    </body>
</html>
